{% extends "base.html" %}
{% block title %}Party Loyalty — Czech Parliament Analyzer{% endblock %}

{% block content %}
<hgroup>
    <h1>Party Loyalty Analysis</h1>
    <p>Which MPs vote against their own party line?</p>
</hgroup>

<details class="methodology">
    <summary>How is the rebellion rate calculated?</summary>
    <article>
        <ol>
            <li><strong>Filter to active votes only</strong> — only votes where the MP pressed YES (A) or NO (B) are considered. Abstentions, absences, and excused MPs are excluded.</li>
            <li><strong>Determine party majority direction</strong> — for each vote, we count how many MPs from each party voted YES vs NO. The direction with more votes becomes the party's position for that vote. Tied votes (equal YES and NO within the party) are excluded.</li>
            <li><strong>Flag rebellions</strong> — an MP "rebels" when they cast an active vote (YES or NO) that goes <em>against</em> their party's majority direction on that specific vote.</li>
            <li><strong>Compute the rate</strong> — Rebellion % = (number of rebellions / total active votes with a clear party direction) x 100.</li>
        </ol>
        <p><strong>Void votes</strong> (zmatecne hlasovani) are excluded from all calculations.</p>
        <p><strong>Note:</strong> A high rebellion rate doesn't necessarily indicate disloyalty — it may reflect an independent-minded MP, a niche policy disagreement, or procedural votes where party discipline is relaxed.</p>
    </article>
</details>

<form hx-get="/api/loyalty" hx-target="#results" hx-indicator="#loading">
    <input type="hidden" name="period" value="{{ period }}">
    <div class="grid">
        <label>
            Top N MPs
            <input type="number" name="top" value="30" min="5" max="200" step="5">
        </label>
        <label>
            Party (optional)
            <input type="text" name="party" placeholder="e.g. ODS, ANO, STAN...">
        </label>
        <label>
            &nbsp;
            <button type="submit">Analyze</button>
        </label>
    </div>
</form>

<span id="loading" class="htmx-indicator" aria-busy="true">Loading...</span>

<div class="chart-container">
    <img src="/charts/loyalty.png?period={{ period }}" alt="Party loyalty chart" loading="lazy">
</div>

<div id="results" hx-get="/api/loyalty?top=30&period={{ period }}" hx-trigger="load" hx-indicator="#loading">
    <div class="skeleton">{% for _ in range(8) %}
    <div class="skeleton-pulse skeleton-table-row"></div>
    {% endfor %}</div>
</div>
{% endblock %}
