{% extends "base.html" %}
{% block title %}{{ _("nav.loyalty") }} â€” Czech Parliament Analyzer{% endblock %}

{% block content %}
<div class="page-header">
    <h1>{{ _("loyalty.title") }}</h1>
    <p>{{ _("loyalty.subtitle") }}</p>
</div>

<details class="methodology">
    <summary>{{ _("loyalty.methodology_title") }}</summary>
    <article>
        <ol>
            <li><strong>{{ _("loyalty.methodology.step1") }}</strong></li>
            <li><strong>{{ _("loyalty.methodology.step2") }}</strong></li>
            <li><strong>{{ _("loyalty.methodology.step3") }}</strong></li>
            <li><strong>{{ _("loyalty.methodology.step4") }}</strong></li>
        </ol>
        <p><strong>{{ _("loyalty.methodology.void") }}</strong></p>
        <p><strong>{{ _("loyalty.methodology.note") }}</strong></p>
    </article>
</details>

<form hx-get="/api/loyalty" hx-target="#results" hx-indicator="#loading">
    <input type="hidden" name="period" value="{{ period }}">
    <div class="form-row">
        <label>
            {{ _("form.top_n") }}
            <input type="number" name="top" value="30" min="5" max="200" step="5">
        </label>
        <label>
            {{ _("form.party") }}
            <input type="text" name="party" placeholder="{{ _('form.party_placeholder') }}">
        </label>
        <div class="form-submit">
            <label>&nbsp;</label>
            <button type="submit">{{ _("btn.analyze") }}</button>
        </div>
    </div>
</form>

<span id="loading" class="htmx-indicator" aria-busy="true">{{ _("loading") }}</span>

<div class="chart-container">
    <img src="/charts/loyalty.png?period={{ period }}" alt="{{ _('loyalty.title') }}" loading="lazy">
</div>

<div id="results" hx-get="/api/loyalty?top=30&period={{ period }}" hx-trigger="load" hx-indicator="#loading">
    <div class="skeleton">{% for _ in range(8) %}
    <div class="skeleton-pulse skeleton-table-row"></div>
    {% endfor %}</div>
</div>
{% endblock %}
